<?xml version="1.0"?>
<tool id="immuno_probs_locate" name="Locate CDR3 anchors" version="0.1.20">
    <requirements>
        <container type="docker">penuts7644/immuno-probs</container>
    </requirements>

    <description>for generating and/or evaluating CDR3 sequences.</description>

    <command>
        immuno-probs

            ## general immuno-probs parameters
            -threads \$GALAXY_SLOTS

            ## tool command
            locate

                ## reference genomic templates
                -ref '$cond_gene.gene' '$cond_gene.file'

                ## specify the mofifs

                #for $i in $repeat_motif

                    -motif '$i.motif'

                #end for
    </command>

    <inputs>
        <conditional name="cond_gene">
            <param name="gene" type="select" label="For which gene should anchors be located?">
                <option value="V" selected="true">V gene</option>
                <option value="J">J gene</option>
            </param>

            <when value="V">
                <param name="file" type="data" format="fasta" label="Reference genomic template - V gene" help="Needs to conform to IGMT annotation." />
            </when>

            <when value="J">
                <param name="file" type="data" format="fasta" label="Reference genomic template - J gene" help="Needs to conform to IGMT annotation." />
            </when>
        </conditional>

        <repeat name="repeat_motif" min="0" max="10" title="motif">
            <param name="motif" type="text" label="Search motif string" />
        </repeat>
    </inputs>

    <outputs>
        <data name="cdr3_anchors" format="tabular" label="${tool.name} on ${on_string}: ${cond_gene.gene} gene">
            <discover_datasets assign_primary_output="true" pattern="[VJ]_gene_CDR3_anchors\.tsv" />
        </data>
    </outputs>

    <help>

        **ImmunoProbs**

        Create IGoR models and calculate the generation probability of V(D)J and CDR3 sequences.

        For documentation have a look at the ImmunoProbs github page "https://penuts7644.github.io/ImmunoProbs/".

    </help>
</tool>
