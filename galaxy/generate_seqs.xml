<?xml version="1.0"?>
<tool id="immuno_probs_generate_seqs" name="Generate sequences" version="0.1.17">
    <requirements>
        <container type="docker">penuts7644/immuno-probs</container>
    </requirements>

    <description>that are full-length V(D)J or CDR3 using a pre-defined model or custom build model.</description>

    <command>
        immuno-probs

            ## general immuno-probs parameters
            -threads \$GALAXY_SLOTS

            ## tool command
            generate-seqs

                ## specify the model and possibly the type
                #if $cond_category.category == "default":

                    -model '$cond_category.default'
                    $cond_category.cdr3

                #elif $cond_category.category == "custom"

                    -custom-model '$cond_category.parameters' '$cond_category.marginals'
                    -type '$cond_category.type'

                    ## specify CDR3 option with anchor files
                    #if $cond_category.cond_cdr3.cdr3:

                        $cond_category.cond_cdr3.cdr3
                        -anchor 'V' '$cond_category.cond_cdr3.anchor_v'
                        -anchor 'J' '$cond_category.cond_cdr3.anchor_j'

                    #end if

                #end if

                ## number of output sequences
                -generate $generate
    </command>

    <inputs>
        <conditional name="cond_category">
            <param name="category" type="select" label="Pre-defined model or custom model?">
                <option value="default" selected="true">Pre-defined</option>
                <option value="custom">Custom build</option>
            </param>

            <when value="default">
                <param name="default" type="select" label="IGoR model">
                    <option value="human-t-alpha" selected="true">Human TCR alpha</option>
                    <option value="human-t-beta">Human TCR beta</option>
                    <option value="human-b-heavy">Human IG heavy</option>
                    <option value="mouse-t-beta">Mouse TCR beta</option>
                </param>
                <param name="cdr3" type="boolean" truevalue=" -cdr3" falsevalue=" " checked="false" label="Generate CDR3 sequences instead of VDJ?" />
            </when>

            <when value="custom">
                <param name="type" type="select" label="Type of IGoR model">
                    <option value="alpha" selected="true">Alpha</option>
                    <option value="beta">Beta</option>
                    <option value="light">Light</option>
                    <option value="heavy">Heavy</option>
                </param>

                <conditional name="cond_cdr3">
                    <param name="cdr3" type="boolean" truevalue=" -cdr3" falsevalue=" " checked="false" label="Generate CDR3 sequences instead of VDJ?" />

                    <when value=" -cdr3">
                        <param name="anchor_v" type="data" format="tabular" label="CDR3 anchors - V gene" help="Use 'Locate CDR3 anchors' to generate file." />
                        <param name="anchor_j" type="data" format="tabular" label="CDR3 anchors - J gene" help="Use 'Locate CDR3 anchors' to generate file." />
                    </when>
                </conditional>

                <param name="parameters" type="data" format="txt" label="Model - parameters" help="Needs to conform to IGoR standards." />

                <param name="marginals" type="data" format="txt" label="Model - marginals" help="Needs to conform to IGoR standards." />
            </when>
        </conditional>

        <param name="generate" type="integer" value="1" min="1" max="1000000" label="Number of sequences" help="The number of output sequences to generate from the specified IGoR model." />
    </inputs>

    <outputs>
        <data name="generated_seqs" format="tabular" label="${tool.name} on ${on_string}: generated sequences">
            <discover_datasets assign_primary_output="true" pattern="generated_seqs_[a-zA-Z]+?(_CDR3){0,1}\.tsv" />
        </data>
    </outputs>

    <help>

        **ImmunoProbs**

        Create IGoR models and calculate the generation probability of V(D)J and CDR3 sequences.

        For documentation have a look at the ImmunoProbs github page "https://penuts7644.github.io/ImmunoProbs/".

    </help>
</tool>
